/*
 * File: app/view/detailsToCustomerWindow.js
 *
 * This file was generated by Sencha Designer version 2.0.0.
 * http://www.sencha.com/products/designer/
 *
 * This file requires use of the Ext JS 4.0.x library, under independent license.
 * License of Sencha Designer does not include license for Ext JS 4.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

Ext.define('cstt.view.detailsToCustomerWindow', {
    extend: 'cstt.view.ui.detailsToCustomerWindow',
    alias: 'widget.detailsToCustomerWindow',

    initComponent: function() {
        var me = this;
        me.callParent(arguments);
    },

    onCloseClick: function(button, e, options) {
        this.close();
    },

    updateContent: function() {
        if(this.couchDBDocID !== 'null') {

            // Wait Message anzeigen	
            Ext.MessageBox.wait('Laden ...', 'Bitte warten ...');

            Ext.Ajax.request({
                method: 'GET',
                url: '../../'+this.couchDBDocID,
                // Header auf application/json setzen - CouchDB
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                scope: this,
                success: function (result, request ) {				
                    // Get JSON 
                    var json = Ext.JSON.decode(result.responseText);	

                    // Titel fuer Fenster setzen
                    this.setTitle('Kundendetails: '+json.company);

                    // Strasse 1 setzen
                    this.down('#street1').setValue(json.street1);				
                    // Strasse 2 setzen
                    this.down('#street2').setValue(json.street2);				
                    // Strasse 3 setzen
                    this.down('#street3').setValue(json.street3);			
                    // PLZ / Ort setzen
                    if (json.zip_code !== undefined) {
                        this.down('#city').setValue(json.zip_code+' '+json.city);
                    } else {
                        this.down('#city').setValue(json.city);
                    }			
                    // Land setzen
                    this.down('#country').setValue(json.country);
                    // Edition setzen
                    this.down('#editionProduct').setValue(json.editionProduct);
                    // AddOns setzen
                    this.down('#addOnsProduct').setValue(json.addOnsProduct);
                    // Lizenzen setzen
                    this.down('#numberOfLicences').setValue(json.numberOfLicences);

                    // Support von
                    if (json.supportFrom !== '') {
                        var supportDateFrom = Ext.Date.parse(json.supportFrom,'Y-m-d');
                        var supportDateFromDMY = Ext.Date.format(supportDateFrom, 'd.m.Y');  
                        this.down('#supportFrom').setValue(supportDateFromDMY);
                    }
                    // Support bis
                    if (json.supportTo !== '') {
                        var supportDateTo = Ext.Date.parse(json.supportTo,'Y-m-d');              
                        var supportDateToDMY = Ext.Date.format(supportDateTo, 'd.m.Y');    
                        this.down('#supportTo').setValue(supportDateToDMY);
                    }
                    
       
                    // Besonderheiten setzen
                    this.down('#specials').setValue(Ext.String.ellipsis(json.specials, 60, false));

                    // Datenschutz setzen
                    if(json.dcpc === true) {
                        this.down('#dcpc').setValue("JA");
                    } else {
                        this.down('#dcpc').setValue("NEIN");
                    }
                   
                    // Wait Message verbergen			
                    Ext.MessageBox.hide();
                    // Fenster anzeigen
                    this.show();
                    
                    // QuickTips nach Fenster show!
                    Ext.QuickTips.register({
				        target: this.down('#specials').getEl(),
				        title: '',
				        text: '<span style="">'+json.specials+'</span>',
				        enabled: true,
				        trackMouse: true
			    	});

                }
            });		
        }
    }

});